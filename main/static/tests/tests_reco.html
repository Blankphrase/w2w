<!doctype html>
<html>
    <head>
        <title>Mocha Tests</title>
        <link rel="stylesheet" href="../../../w2w/static/tests/mocha.css">
    </head>

    <body>

        <div id="mocha"></div>

        <script src="../../../w2w/static/tests/jquery-3.1.0.js"></script>
        <script src="../../../w2w/static/tests/mocha.js"></script>
        <script src="../../../w2w/static/tests/chai.js"></script>
        <script src="../../../w2w/static/tests/sinon.js"></script>
        <script>mocha.setup("bdd");</script>

        <!-- load code you want to test heere -->

        <script src="../js/prefs.source.js"></script>
        <script src="../js/reco.ui.js"></script>

        <!-- load your test files here -->
        <script src="test.storage.js"></script>
        <script>

            testStorage.setItem(
                "reco-pref",
                JSON.stringify([ 
                    {id: 1, title: "movie1", rating: 1},
                    {id: 2, title: "movie2", rating: 2},
                    {id: 3, title: "movie3", rating: 3}
                ])
            )

            var assert = chai.assert;
            var source;

            describe("prefsList global object with session data", function() {

                beforeEach(function() {
                    source = new SessionBasedPrefsSource(testStorage);
                });

                it("init method updates data in source", function() {
                    prefsList.init(source);
                    assert.equal(source.count(), 3);
                });

                it("init method calls updateList method", function() {
                    prefsList.updateList = sinon.spy();
                    prefsList.init(source); 
                    assert.isTrue(prefsList.updateList.called);
                });

            });

        </script>

        <script>
            mocha.run();
        </script>
    </body>

</html>